<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Übung 7</title>

    <link rel="stylesheet" href="../../resources/dark-theme.css">

    <style>
        .centered {
            display: flex;
            justify-content: center;
            width: 100%;
        }
    </style>

</head>
<body>
    <nav class="navi">
        <a class="nav_hover_element" href="../6/1.html">Letzte Übung</a>
        <a class="nav_hover_element" href="../../index.html">Hauptmenü</a>
        <a class="nav_hover_element" href="../8/1.html">Nächste Übung</a>
    </nav>
    <div class="centered">
        <div class="header">
            <h1> Übung 7 </h1>
            <h2> Funktionale Programmierung </h2>
        </div>
        <h1>
            Diese Übung hat nur funktionales JavaScript! <br>
            Bitte in den Quellcode schauen...
        </h1>
    </div>

    <script>
        function add(x, y) {
            return x + y;
        }

        function identity_function(x) {
            return function() { return x; };
        }

        function addf(x) {
            return function(y) {
                return x + y;
            };
        }

        function applyf(func) {
            return function(x) {
                return function(y) {
                    return func(x, y);
                };
            };
        }

        function curry(func, param) {
            return function(x) {
                return func(param, x);
            };
        }

        const inc = addf(1);
        const inc2 = applyf(add)(1);
        const inc3 = curry(add, 1);

        function methodize(func) {
            return function(x) {
                return func(this, x);
            };
        }

        function demethodize(func) {
            return function(x, y) {
                return func.call(x, y);
            };
        }

        Number.prototype.add = methodize(add);
        console.log("Demethodized function: " + demethodize(Number.prototype.add)(11, 1));

        function twice(func) {
            return function(x) {
                return func(x, x);
            };
        }

        console.log("Twiced add(): " + twice(add)(5));

        function composeu(func1, func2) {
            return function(x) {
                return func2(func1(x));
            };
        }

        console.log("ComposeU'd inc(): " + composeu(inc, inc)(1));

        function composeb(func1, func2) {
            return function(x, y, z) {
                return func2(func1(x, y), z);
            };
        }

        console.log("ComposeB'd add(): " + composeb(add, add)(1, 2, 3));

        function once(func) {
            return function(...x) {
                const result = func(...x);
                func = function() { return "ONCED OUT."; };
                return result;
            }
        }

        const onced_add = once(add);
        console.log("First call of add(): " + onced_add(1, 2));
        console.log("Second call of add(): " + onced_add(1, 2)); // => returns "ONCED OUT."

        function counterf(x) {
            return {
                value: x,
                inc: function() { this.value++; },
                dec: function() { this.value--; }
            }
        }

        const counter = counterf(10);
        counter.inc();
        console.log("Counter inc: " + counter.value);
        counter.dec();
        console.log("Counter dec: " + counter.value);

        function revocable(func) {
            return {
                invoke: function(...x) { return func(...x); },
                revoke: function() { this.invoke = function() { return "REVOKED"; }; }
            }
        }

        const temp = revocable(alert);
        temp.invoke('Press Me!');
        temp.revoke();
        temp.invoke('Press Me Again!');

        function vector() {
            return {
                array : [],
                append : function(value) { this.array.push(value) },
                store : function(index, value) { this.array[index] = value; },
                get : function(index) { return this.array[index]; }
            }
        }

        const my_vector = vector()
        my_vector.append(1);
        my_vector.store(1, 2);
        console.log(my_vector.get(0));
        console.log(my_vector.get(1));

    </script>
    <script>
        // Source: https://github.com/stopwords-iso/stopwords-de
        let stopwords;
        let text;

        let mostOccuringWords;

        // Load both before processing
        Promise.all([
            fetch("./resources/stopwords.json")
                .then( response => response.json())
                .then( value => { stopwords = value; }),
            fetch("./resources/text.txt")
                .then ( response => response.text() )
                .then ( value => { text = value; })
        ]).then( () => main() );

        function analyse(_text=text, _stopwords=stopwords, _top=3) {
            _text = _text
                .split(/[ \-,.!?:;"'(){}\[\]\s]+/) // Regex to filter out stuff
                .filter((element) => {
                    return !_stopwords.includes(element)
                })

            /*
                Clever reduce method from: https://stackoverflow.com/questions/5667888/counting-the-occurrences-frequency-of-array-elements
                Starts with an empty Map. >{}
                Checks if an entry exists, if yes, increment value,
                    if not, create entry with value of 1.
                Due to comma operator, return that Map and continue reducing.
            */
            const occurrences = _text
                .reduce((occurrences, current) => {
                    return occurrences.set(current, (occurrences.get(current) || 0) + 1), occurrences;
                }, new Map());

            _text = _text
                .filter((current, index) => _text.indexOf(current) === index)
                .sort((a, b) => occurrences.get(b) - occurrences.get(a));

            return _text.slice(0, _top);
        }

        function main() {
            const mostOccurringWords = analyse(text, stopwords);
            // Print the three most common words.
            const nMostCommon = 3;
            for (let i = 0; i < mostOccurringWords.length; i++) {
                if (i > nMostCommon-1) break;
                console.log(mostOccurringWords[i]);
            }
        }
    </script>
</body>
</html>