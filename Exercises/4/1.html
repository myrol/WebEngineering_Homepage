<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="../../resources/dark-theme.css">

    <meta charset="UTF-8">
    <title>Übung 4</title>
</head>
<body>
    <nav class="navi">
        <a class="nav_hover_element" href="../3/0.html">Letzte Übung</a>
        <a class="nav_hover_element" href="../../index.html">Hauptmenü</a>
        <a class="nav_hover_element" href="../5/1.html">Nächste Übung</a>
    </nav>

    <div class="centered">
        <div class="header">
            <h1> Übung 4 </h1>
            <h2> JavaScript </h2>
        </div>

        <div class="header">
            <h2> Aufgabe 1 </h2>
            <h3> Funktionen </h3>
        </div>
        <div class="content">
            <div class="code">
<pre><code>function identity(x) {
    return x;
}
</code></pre>
            </div>
            <div class="input-elements">
                <textarea id="i1" class="input-field" rows="1"></textarea>
                <button id="b1" class="input-button">Eingeben</button>
            </div>
            <p id="o1" class="output"></p>
        </div>
        <div class="content">
            <div class="code">
<pre><code>function identity_function(func) {
    return identity(x);
}
</code></pre>
            </div>
        </div>
        <div class="content">
            <div class="code">
<pre><code>function add(x, y) {
    return x + y;
}
</code></pre>
            </div>
            <div class="input-elements">
                <textarea id="i2-1" class="input-field" rows="1"></textarea>
                <textarea id="i2-2" class="input-field" rows="1"></textarea>
                <button id="b2" class="input-button">Eingeben</button>
            </div>
            <p id="o2" class="output"></p>
        </div>
        <div class="content">
            <div class="code">
<pre><code>function mul(x, y) {
    return x * y;
}
</code></pre>
            </div>
            <div class="input-elements">
                <textarea id="i3-1" class="input-field" rows="1"></textarea>
                <textarea id="i3-2" class="input-field" rows="1"></textarea>
                <button id="b3" class="input-button">Eingeben</button>
            </div>
            <p id="o3" class="output"></p>
        </div>
        <div class="content">
            <div class="code">
<pre><code>function addf(x) {
    return function(y) {
        return x + y;
    };
}
</code></pre>

            </div>
        </div>
        <div class="content">
            <div class="code">
<pre><code>function applyf(func) {
    return function(x) {
        return function(y) {
            return func(x, y);
        };
    };
}
</code></pre>
            </div>
        </div>
        <div class="header">
            <h2> Aufgabe 2 </h2>
            <h3> Objekte </h3>
        </div>
        <div class="content">
            Prototypen-Generatoren:
            <div class="code">
<pre><code>function Auto(kz) {
    return {
        kennzeichen : kz
    };
}
<br>
function Person(auto_kz) {
    return {
        auto_kennzeichen : auto_kz
    };
}
</code></pre>
            </div>
            <div class="input-elements">
                <textarea id="i4-1" class="input-field" rows="1" placeholder="Kennzeichen"></textarea>
                <button id="b4-1" class="input-button">Auto generieren</button>
            </div>
            <div class="input-elements">
                <textarea id="i4-2" class="input-field" rows="1" placeholder="Kennzeichen"></textarea>
                <button id="b4-2" class="input-button">Person generieren</button>
            </div>
            <div class="input-elements">
                <button id="b4-3" class="input-button">Auf Konflikte Prüfen</button>
            </div>
            <p id="o4-1" class="output">Liste aller Autos</p>
            <p id="o4-2" class="output">Liste aller Personen</p>
            <p id="o4-3" class="output">Konflikte</p>
        </div>
        <div class="header">
            <h2> Aufgabe 3 </h2>
            <h3> Fibonacci </h3>
        </div>
        <div class="content">
            Berechnung der Fibonacci-Zahl <span class="code">n</span>
            <div class="code">
<pre><code>function fib(n) {
    if (n === '') {
        n = 1000;
    }
    if (n < 0) {
        return -1;
    }
    if (n < fibs.length) {
        return fibs[n];
    }
    while (fibs.length <= n) {
        fibs[fibs.length] = fibs[fibs.length-1] + fibs[fibs.length-2];
    }
    return fibs[fibs.length-1];
}
</code></pre>
            </div>
            <div class="input-elements">
                <textarea id="i5" class="input-field" rows="1" placeholder="2000"></textarea>
                <button id="b5" class="input-button">Eingeben</button>
            </div>
            <p id="o5" class="output"></p>

            Berechnung der maximal mit einer <span class="code">Integer</span> darstellbaren Zahl.
            <div class="code">
<pre><code>function last_safe_integer_index() {
    for (let i = 0; i < fibs.length; i++) {
        if (fibs[i] >= Number.MAX_SAFE_INTEGER) {
            return i-1;
        }
    }
}
</code></pre>

            </div>
            <div class="input-elements">
                <button id="b6" class="input-button">Berechnen</button>
            </div>
            <p id="o6" class="output"></p>

            Berechnung der maximal mit einer <span class="code">Number</span> darstellbaren Zahl.
            <div class="code">
<pre><code>function last_max_value() {
    for (let i = 0; i < fibs.length; i++) {
        if (fibs[i] > Number.MAX_VALUE) {
            return i-1;
        }
    }
}
</code></pre>
            </div>
            <div class="input-elements">
                <button id="b7" class="input-button">Berechnen</button>
            </div>
            <p id="o7" class="output"></p>
        </div>
    </div>
    <!-- Interaction   --->
    <script>
        // Set all textareas default behaviour for enter:
        const textareas = document.querySelectorAll('textarea.input-field');
        for (const area of textareas) {
            area.addEventListener('keyup', () => {
                if (event.keyCode === 13) {
                    event.preventDefault(); // Prevent default behaviour of adding a new line (not working?)
                    document.getElementById('b' + area.id.substring(1)).click(); // Click the button next to it
                    area.value = ''; // Clear input
                }
            })
        }

        // Set all output fields to have text '> ' if nothing is set
        const outputFields = document.querySelectorAll('p.output');
        for (const field of outputFields) {
            if (field.textContent !== '') {
                continue;
            }

            field.textContent = '> ';
        }
        // Set all input fields to have placeholders if nothing is set
        const inputFields = document.querySelectorAll('textarea.input-field');
        for (const field of inputFields) {
            if (field.placeholder !== '') {
                continue;
            }

            field.placeholder = 'Input Parameter!';
        }

        /*
            This function takes in a function, and output field
            and input values for the function to take in.

            This is used for the interactiveness of the solutions
        */
        function calcUserInput(func, output, ...input) {
            output.innerHTML = '> ' + func(...input);
            visualOutputUpdate(output);
        }

        /*
            Source: https://stackoverflow.com/questions/49732609/how-can-i-fade-text-in-using-javascript-with-button
        */
        function visualOutputUpdate(outputField) {
            outputField.classList.add('update-field-animation');
            setTimeout(() => outputField.classList.remove('update-field-animation'), 1000);
        }

        const identity_input = document.getElementById('i1');
        const identity_button = document.getElementById('b1');
        const identity_output = document.getElementById('o1');

        identity_button.addEventListener('click',
            () => calcUserInput(identity,
                identity_output,
                identity_input.value))

        const add_input1 = document.getElementById('i2-1');
        const add_input2 = document.getElementById('i2-2');
        const add_button = document.getElementById('b2');
        const add_output = document.getElementById('o2');

        add_button.addEventListener('click',
            () => calcUserInput(add,
                add_output,
                Number(add_input1.value),
                Number(add_input2.value)))

        const mul_input1 = document.getElementById('i3-1');
        const mul_input2 = document.getElementById('i3-2');
        const mul_button = document.getElementById('b3');
        const mul_output = document.getElementById('o3');

        mul_button.addEventListener('click',
            () => calcUserInput(mul,
                mul_output,
                Number(mul_input1.value),
                Number(mul_input2.value)))

        const obj_input1 = document.getElementById('i4-1');
        const obj_input2 = document.getElementById('i4-2');
        const obj_button1 = document.getElementById('b4-1');
        const obj_button2 = document.getElementById('b4-2');
        const obj_button3 = document.getElementById('b4-3');
        const obj_output1 = document.getElementById('o4-1');
        const obj_output2 = document.getElementById('o4-2');
        const obj_output3 = document.getElementById('o4-3');

        obj_button1.addEventListener('click',
            () => calcUserInput(addAuto,
                obj_output1,
                obj_input1.value));

        obj_button2.addEventListener('click',
            () => calcUserInput(addPerson,
                obj_output2,
                obj_input2.value));

        obj_button3.addEventListener('click',
            () => calcUserInput(conflict_all,
                obj_output3));

        const fib_input1 = document.getElementById('i5');
        const fib_button1 = document.getElementById('b5');
        const fib_output1 = document.getElementById('o5');
        const fib_button2 = document.getElementById('b6');
        const fib_output2 = document.getElementById('o6');
        const fib_button3 = document.getElementById('b7');
        const fib_output3 = document.getElementById('o7');

        fib_button1.addEventListener('click',
            () => calcUserInput(fib,
                fib_output1,
                fib_input1.value));

        fib_button2.addEventListener('click',
            () => calcUserInput(last_safe_integer_index,
                fib_output2));

        fib_button3.addEventListener('click',
            () => calcUserInput(last_max_value,
                fib_output3));

    </script>

    <!-- Teilaufgabe 1 --->
    <script>
        function identity(x) {
            return x;
        }

        function identity_function(x) {
            return identity(x);
        }

        function add(x, y) {
            return x + y;
        }

        function mul(x, y) {
            return x * y;
        }

        function addf(x) {
            return function(y) {
                return x + y;
            };
        }

        function applyf(func) {
            return function(x) {
                return function(y) {
                    return func(x, y);
                };
            };
        }
    </script>

    <!-- Teilaufgabe 2 --->
    <script>
        let autos = [];
        let personen = [];

        function Auto(kz) {
            return {
                kennzeichen : kz
            };
        }

        function Person(auto_kz) {
            return {
                auto_kennzeichen : auto_kz
            };
        }

        /*
            This function adds a car object to the 'autos' array.
            As no car can have the same license plate as another,
            this function also checks for duplicates.
         */
        function addAuto(kz) {
            // If empty license plate, return an error message.
            if (kz === '') return 'Kennzeichen eingeben!';

            // Check for duplicates
            let conflict = false;
            for (const a of autos) {
                if (a.kennzeichen === kz) {
                    obj_output1.style = 'color: red'; // Mark output as red to indicate error
                    conflict = true;
                    break;
                }
            }

            // If no duplicates, set color back to white if not already.
            if (!conflict) {
                obj_output1.style = 'color: #e1e1e1';
                autos.push(Auto(kz));
            }

            // Update Display
            let output = '';
            const separator = '<br>&ensp;&ensp;';
            for (const a of autos) {
                output += separator + a.kennzeichen;
            }
            output = output.substring(separator.length); // Remove first comma and <br>
            return output;
        }

        /*
            Adds a person to the 'personen' array.
         */
        function addPerson(auto_kz) {
            personen.push(Person(auto_kz));
            let output = '';
            const separator = '<br>&ensp;&ensp;';
            for (const p of personen) {
                output += separator + p.auto_kennzeichen;
            }
            output = output.substring(separator.length); // Remove first comma and <br>
            return output;
        }

        /*
            Checks for any car 'auto' to have multiple persons assigned as it's owner.
         */
        function conflict(auto) {
            let matches = 0;
            for (let i in personen) {
                if (personen[i].auto_kennzeichen === auto.kennzeichen) {
                    matches++;
                }
            }
            // If more than one person is linked to car 'auto' it's a conflict.
            return matches > 1;
        }

        /*
            Checks for all cars from 'autos' to have multiple persons assigned to them.
         */
        function conflict_all() {
            let conflicts = [];
            for (const a of autos) {
                let output = ' ' + a.kennzeichen + ': ';
                let matches = 0;
                for (const p of personen) {
                    if (a.kennzeichen === p.auto_kennzeichen) {
                        matches++;
                    }
                }
                if (matches <= 1) {
                    output += matches + ' Besitzer<br>';
                } else {
                    output += '<span style="color:red">' + matches + ' Besitzer</span><br>';
                }
                conflicts.push(output);
            }
            return conflicts;
        }
    </script>

    <!-- Teilaufgabe 3 --->
    <script>
        var fibs = [0, 1];

        function fib(n) {
            if (n === '') {
                n = 2000;
            }
            if (n < 0) {
                return -1;
            }
            if (n < fibs.length) {
                return fibs[n];
            }
            while (fibs.length <= n) {
                fibs[fibs.length] = fibs[fibs.length-1] + fibs[fibs.length-2]
            }

            return fibs[fibs.length-1];
        }

        function last_safe_integer_index() {
            for (let i = 0; i < fibs.length; i++) {
                if (fibs[i] >= Number.MAX_SAFE_INTEGER) {
                    return i-1;
                }
            }
        }

        function last_max_value() {
            for (let i = 0; i < fibs.length; i++) {
                if (fibs[i] > Number.MAX_VALUE) {
                    return i-1;
                }
            }
        }
    </script>
</body>
</html>