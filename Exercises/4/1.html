<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="../../resources/dark-theme.css">

    <meta charset="UTF-8">
    <title>Übung 4</title>
</head>
<body>
    <div class="centered">
        <div class="header">
            <h1> Übung 4 </h1>
            <h2> JavaScript </h2>
        </div>

        <div class="header">
            <h2> Aufgabe 1 </h2>
            <h3> Funktionen </h3>
        </div>
        <div class="content">
            <p class="code">
                function identity(x) {<br>
                &ensp;&ensp;&ensp;&ensp;return x;<br>
                }
            </p>
            <div class="input-elements">
                <textarea id="i1" class="input-field" rows="1"></textarea>
                <button id="b1" class="input-button">Eingeben</button>
            </div>
            <p id="o1" class="output"></p>
        </div>
        <div class="content">
            <p class="code">
                function identity_function(func) {<br>
                &ensp;&ensp;&ensp;&ensp;return identity(x);<br>
                }
            </p>
        </div>
        <div class="content">
            <p class="code">
                function add(x, y) {<br>
                &ensp;&ensp;&ensp;&ensp;return x + y;<br>
                }
            </p>
            <div class="input-elements">
                <textarea id="i2-1" class="input-field" rows="1"></textarea>
                <textarea id="i2-2" class="input-field" rows="1"></textarea>
                <button id="b2" class="input-button">Eingeben</button>
            </div>
            <p id="o2" class="output"></p>
        </div>
        <div class="content">
            <p class="code">
                function mul(x, y) {<br>
                &ensp;&ensp;&ensp;&ensp;return x * y;<br>
                }
            </p>
            <div class="input-elements">
                <textarea id="i3-1" class="input-field" rows="1"></textarea>
                <textarea id="i3-2" class="input-field" rows="1"></textarea>
                <button id="b3" class="input-button">Eingeben</button>
            </div>
            <p id="o3" class="output"></p>
        </div>
        <div class="content">
            <p class="code">
                function addf(x) {<br>
                &ensp;&ensp;&ensp;&ensp;return function(y) {<br>
                &ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;return x + y;<br>
                &ensp;&ensp;&ensp;&ensp;};<br>
                }
            </p>
        </div>
        <div class="content">
            <p class="code">
                function applyf(func) {<br>
                &ensp;&ensp;&ensp;&ensp;return function(x) {<br>
                &ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;return function(y) {<br>
                &ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;return func(x, y);<br>
                &ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;};<br>
                &ensp;&ensp;&ensp;&ensp;};<br>
                }
            </p>
        </div>
        <div class="header">
            <h2> Aufgabe 2 </h2>
            <h3> Objekte </h3>
        </div>
        <div class="content">
            Prototypen-Generatoren:
            <p class="code">
                function Auto(kz) {<br>
                &ensp;&ensp;&ensp;&ensp;return {<br>
                &ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;kennzeichen : kz<br>
                &ensp;&ensp;&ensp;&ensp;};<br>
                }<br>
                <br>
                function Person(auto_kz) {<br>
                &ensp;&ensp;&ensp;&ensp;return {<br>
                &ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;auto_kennzeichen : auto_kz<br>
                &ensp;&ensp;&ensp;&ensp;};<br>
                }
            </p>
            <div class="input-elements">
                <textarea id="i4-1" class="input-field" rows="1" placeholder="Kennzeichen"
                          onkeyup="autoEnterField(event, this, document.getElementById('b4-1'));"></textarea>
                <button id="b4-1" class="input-button">Auto generieren</button>
            </div>
            <div class="input-elements">
                <textarea id="i4-2" class="input-field" rows="1" placeholder="Kennzeichen"></textarea>
                <button id="b4-2" class="input-button">Person generieren</button>
            </div>
            <div class="input-elements">
                <button id="b4-3" class="input-button">Auf Konflikte Prüfen</button>
            </div>
            <p id="o4-1" class="output">Liste Aller Autos</p>
            <p id="o4-2" class="output">Liste Aller Personen</p>
            <p id="o4-3" class="output">Konflikte</p>
        </div>
    </div>

    <h1 onclick="console.log(applyf(add)(1)(1)); this.innerHTML = 'Clicked!';">Click me!</h1>
    <h1 onclick="console.log(conflict(a3)); this.innerHTML = 'Clicked!';">Click me 2!</h1>
    <h1 onclick="console.log(fib(x = prompt('Default is 1000'))); this.innerHTML = 'Clicked!';">Click me for fib number!</h1>
    <h1 onclick="console.log(last_safe_integer_index()); this.innerHTML = last_safe_integer_index();">Click me for last safe int index!</h1>
    <h1 onclick="console.log(last_max_value()); this.innerHTML = last_max_value();">Click me for last max value index!</h1>

    <!-- Interaction   --->
    <script>
        // Set all textareas default behaviour for enter:
        const textareas = document.querySelectorAll('textarea.input-field');
        for (const area of textareas) {
            area.onkeyup = () => {
                autoEnterField(event, this, document.getElementById('b' + area.id.substring(1)));
            }
        }

        // Textarea: enter presses the button next to it:
        function autoEnterField(event, field, button) {
            if (event.keyCode === 13) {
                button.click();
                field.value = '';
                event.preventDefault();
            }
        }

        // Set all output fields to have text '> ' if nothing is set
        const outputFields = document.querySelectorAll('p.output');
        for (const field of outputFields) {
            if (field.textContent !== '') {
                continue;
            }

            field.textContent = '> ';
        }
        // Set all input fields to have placeholders if nothing is set
        const inputFields = document.querySelectorAll('textarea.input-field');
        for (const field of inputFields) {
            if (field.placeholder !== '') {
                continue;
            }

            field.placeholder = 'Input Parameter!';
        }

        /*
            This function takes in a function, and output field
            and input values for the function to take in.

            This is used for the interactiveness of the solutions
        */
        function calcUserInput(func, output, ...input) {
            output.textContent = '> ' + func(...input);
            visualOutputUpdate(output);
        }

        /*
            Source: https://stackoverflow.com/questions/49732609/how-can-i-fade-text-in-using-javascript-with-button
        */
        function visualOutputUpdate(outputField) {
            outputField.classList.add('update-field-animation');
            setTimeout(() => outputField.classList.remove('update-field-animation'), 1000);
        }

        const identity_input = document.getElementById('i1');
        const identity_button = document.getElementById('b1');
        const identity_output = document.getElementById('o1');

        identity_button.addEventListener('click',
            () => calcUserInput(identity,
                identity_output,
                identity_input.value))

        const add_input1 = document.getElementById('i2-1');
        const add_input2 = document.getElementById('i2-2');
        const add_button = document.getElementById('b2');
        const add_output = document.getElementById('o2');

        add_button.addEventListener('click',
            () => calcUserInput(add,
                add_output,
                Number(add_input1.value),
                Number(add_input2.value)))

        const mul_input1 = document.getElementById('i3-1');
        const mul_input2 = document.getElementById('i3-2');
        const mul_button = document.getElementById('b3');
        const mul_output = document.getElementById('o3');

        mul_button.addEventListener('click',
            () => calcUserInput(mul,
                mul_output,
                Number(mul_input1.value),
                Number(mul_input2.value)))

        const obj_input1 = document.getElementById('i4-1');
        const obj_input2 = document.getElementById('i4-2');
        const obj_button1 = document.getElementById('b4-1');
        const obj_button2 = document.getElementById('b4-2');
        const obj_button3 = document.getElementById('b4-3');
        const obj_output1 = document.getElementById('o4-1');
        const obj_output2 = document.getElementById('o4-2');
        const obj_output3 = document.getElementById('o4-3');

        obj_button1.addEventListener('click',
            () => calcUserInput(addAuto,
                obj_output1,
                obj_input1.value));

        obj_button2.addEventListener('click',
            () => calcUserInput(addPerson,
                obj_output2,
                obj_input2.value));

        obj_button3.addEventListener('click',
            () => calcUserInput(conflict_all,
                obj_output3));

    </script>

    <!-- Teilaufgabe 1 --->
    <script>
        function identity(x) {
            return x;
        }

        function identity_function(x) {
            return identity(x);
        }

        function add(x, y) {
            return x + y;
        }

        function mul(x, y) {
            return x * y;
        }

        function addf(x) {
            return function(y) {
                return x + y;
            };
        }

        function applyf(func) {
            return function(x) {
                return function(y) {
                    return func(x, y);
                };
            };
        }
    </script>

    <!-- Teilaufgabe 2 --->
    <script>
        let autos = [];
        let personen = [];

        function Auto(kz) {
            return {
                kennzeichen : kz
            };
        }

        function Person(auto_kz) {
            return {
                auto_kennzeichen : auto_kz
            };
        }

        function addAuto(kz) {
            if (kz === '') return 'Kennzeichen eingeben!';

            // No duplicates allowed!
            let conflict = false;
            for (const a of autos) {
                if (a.kennzeichen === kz) {
                    obj_output1.style = 'color: red';
                    conflict = true;
                    break;
                }
            }

            if (!conflict) {
                obj_output1.style = 'color: #e1e1e1';
                autos.push(Auto(kz));
            }

            // Display
            let output = '';
            for (const a of autos) {
                output += a.kennzeichen + ', ';
            }
            return output;
        }

        function addPerson(auto_kz) {
            personen.push(Person(auto_kz));
            let output = '';
            for (const p of personen) {
                output += p.auto_kennzeichen + ', ';
            }
            return output;
        }

        function updateDisplay(display) {
            let output = '';
            for (const a of autos) {
                output += a.kennzeichen + ',<br>'
            }
            display.textContent = output;
        }

        function conflict(auto) {
            let matches = 0;
            for (let i in personen) {
                if (personen[i].auto_kennzeichen === auto.kennzeichen) {
                    matches++;
                }
            }
            // If more than one person is linked to car 'auto' it's a conflict.
            return matches > 1;
        }

        function conflict_all() {
            let conflicts = [];
            for (const a of autos) {
                let output = ' ' + a.kennzeichen + ': ';
                let matches = 0;
                for (const p of personen) {
                    if (a.kennzeichen === p.auto_kennzeichen) {
                        matches++;
                    }
                }
                output += matches + ' Besitzer';
                conflicts.push(output);
            }
            return conflicts;
        }
    </script>

    <!-- Teilaufgabe 3 --->
    <script>
        var fibs = [0, 1];

        function fib(n) {
            if (n === '') {
                n = 1000;
            }

            if (n < 0) {
                return -1;
            }

            if (n < fibs.length) {
                return fibs[n];
            }

            while (fibs.length <= n) {
                fibs[fibs.length] = fibs[fibs.length-1] + fibs[fibs.length-2]
            }

            return fibs[fibs.length-1];
        }

        function last_safe_integer_index() {
            for (let i = 0; i < fibs.length; i++) {
                if (fibs[i] >= Number.MAX_SAFE_INTEGER) {
                    return i-1;
                }
            }
        }

        function last_max_value() {
            for (let i = 0; i < fibs.length; i++) {
                if (fibs[i] > Number.MAX_VALUE) {
                    return i-1;
                }
            }
        }
    </script>
</body>
</html>